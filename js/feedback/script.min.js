$(function(){$("#reload-captcha").click(function(){$("#img-captcha").attr("src","/feedback/captcha.php?id="+Math.random())}),$("#contactForm").submit(function(a){a.preventDefault();var e=!0;$("#contactForm input,textarea").each(function(){if("text-captcha"==$(this).attr("id"))return!0;var a=$(this).parents(".form-group"),r=a.find(".form-control-feedback");this.checkValidity()?(a.addClass("has-success").removeClass("has-error"),r.addClass("glyphicon-ok").removeClass("glyphicon-remove")):(a.addClass("has-error").removeClass("has-success"),r.addClass("glyphicon-remove").removeClass("glyphicon-ok"),e=!1)});var r=$("#text-captcha").val();if(6!=r.length&&(inputCaptcha=$("#text-captcha"),formGroupCaptcha=inputCaptcha.parents(".form-group"),glyphiconCaptcha=formGroupCaptcha.find(".form-control-feedback"),formGroupCaptcha.addClass("has-error").removeClass("has-success"),glyphiconCaptcha.addClass("glyphicon-remove").removeClass("glyphicon-ok")),e&&6==r.length){var o=$("#name").val(),t=$("#email").val(),c=$("#message").val(),r=$("#text-captcha").val(),s=new FormData;s.append("name",o),s.append("email",t),s.append("message",c),s.append("captcha",r),$.ajax({type:"POST",url:"/feedback/process.php",data:s,contentType:!1,processData:!1,cache:!1,success:function(a){var e=JSON.parse(a);$("#error").text(""),"success"==e.result?($("#contactForm").hide(),$("#successMessage").removeClass("hidden")):"invalidCaptcha"==e.result?(inputCaptcha=$("#text-captcha"),formGroupCaptcha=inputCaptcha.parents(".form-group"),glyphiconCaptcha=formGroupCaptcha.find(".form-control-feedback"),formGroupCaptcha.addClass("has-error").removeClass("has-success"),glyphiconCaptcha.addClass("glyphicon-remove").removeClass("glyphicon-ok"),$("#img-captcha").attr("src","/feedback/captcha.php?id="+Math.random()),$("#text-captcha").val("")):$("#error").text("Произошли ошибки при отправке формы на сервер.")},error:function(a){$("#error").text("Произошла ошибка "+a.responseText+" при отправке данных.")}})}})});
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){var e,i=navigator.userAgent,n=/iphone/i.test(i),o=/chrome/i.test(i),r=/android/i.test(i);t.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},t.fn.extend({caret:function(t,e){var i;return 0===this.length||this.is(":hidden")?void 0:"number"==typeof t?(e="number"==typeof e?e:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,e):this.createTextRange&&(i=this.createTextRange(),i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,e=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),t=0-i.duplicate().moveStart("character",-1e5),e=t+i.text.length),{begin:t,end:e})},unmask:function(){return this.trigger("unmask")},mask:function(i,a){var s,l,c,d,f,h,p,u;if(!i&&this.length>0){s=t(this[0]);var v=s.data(t.mask.dataName);return v?v():void 0}return a=t.extend({autoclear:t.mask.autoclear,placeholder:t.mask.placeholder,completed:null},a),l=t.mask.definitions,c=[],d=p=i.length,f=null,t.each(i.split(""),function(t,e){"?"==e?(p--,d=t):l[e]?(c.push(new RegExp(l[e])),null===f&&(f=c.length-1),d>t&&(h=c.length-1)):c.push(null)}),this.trigger("unmask").each(function(){function s(){if(a.completed){for(var t=f;h>=t;t++)if(c[t]&&I[t]===v(t))return;a.completed.call(x)}}function v(t){return a.placeholder.charAt(t<a.placeholder.length?t:0)}function g(t){for(;++t<p&&!c[t];);return t}function m(t){for(;--t>=0&&!c[t];);return t}function b(t,e){var i,n;if(!(0>t)){for(i=t,n=g(e);p>i;i++)if(c[i]){if(!(p>n&&c[i].test(I[n])))break;I[i]=I[n],I[n]=v(n),n=g(n)}S(),x.caret(Math.max(f,t))}}function y(t){var e,i,n,o;for(e=t,i=v(t);p>e;e++)if(c[e]){if(n=g(e),o=I[e],I[e]=i,!(p>n&&c[n].test(o)))break;i=o}}function w(){var t=x.val(),e=x.caret();if(u&&u.length&&u.length>t.length){for(k(!0);e.begin>0&&!c[e.begin-1];)e.begin--;if(0===e.begin)for(;e.begin<f&&!c[e.begin];)e.begin++;x.caret(e.begin,e.begin)}else{for(k(!0);e.begin<p&&!c[e.begin];)e.begin++;x.caret(e.begin,e.begin)}s()}function $(){k(),x.val()!=N&&x.change()}function T(t){if(!x.prop("readonly")){var e,i,o,r=t.which||t.keyCode;u=x.val(),8===r||46===r||n&&127===r?(e=x.caret(),i=e.begin,o=e.end,o-i===0&&(i=46!==r?m(i):o=g(i-1),o=46===r?g(o):o),E(i,o),b(i,o-1),t.preventDefault()):13===r?$.call(this,t):27===r&&(x.val(N),x.caret(0,k()),t.preventDefault())}}function C(e){if(!x.prop("readonly")){var i,n,o,a=e.which||e.keyCode,l=x.caret();if(!(e.ctrlKey||e.altKey||e.metaKey||32>a)&&a&&13!==a){if(l.end-l.begin!==0&&(E(l.begin,l.end),b(l.begin,l.end-1)),i=g(l.begin-1),p>i&&(n=String.fromCharCode(a),c[i].test(n))){if(y(i),I[i]=n,S(),o=g(i),r){var d=function(){t.proxy(t.fn.caret,x,o)()};setTimeout(d,0)}else x.caret(o);l.begin<=h&&s()}e.preventDefault()}}}function E(t,e){var i;for(i=t;e>i&&p>i;i++)c[i]&&(I[i]=v(i))}function S(){x.val(I.join(""))}function k(t){var e,i,n,o=x.val(),r=-1;for(e=0,n=0;p>e;e++)if(c[e]){for(I[e]=v(e);n++<o.length;)if(i=o.charAt(n-1),c[e].test(i)){I[e]=i,r=e;break}if(n>o.length){E(e+1,p);break}}else I[e]===o.charAt(n)&&n++,d>e&&(r=e);return t?S():d>r+1?a.autoclear||I.join("")===D?(x.val()&&x.val(""),E(0,p)):S():(S(),x.val(x.val().substring(0,r+1))),d?e:f}var x=t(this),I=t.map(i.split(""),function(t,e){return"?"!=t?l[t]?v(e):t:void 0}),D=I.join(""),N=x.val();x.data(t.mask.dataName,function(){return t.map(I,function(t,e){return c[e]&&t!=v(e)?t:null}).join("")}),x.one("unmask",function(){x.off(".mask").removeData(t.mask.dataName)}).on("focus.mask",function(){if(!x.prop("readonly")){clearTimeout(e);var t;N=x.val(),t=k(),e=setTimeout(function(){x.get(0)===document.activeElement&&(S(),t==i.replace("?","").length?x.caret(0,t):x.caret(t))},10)}}).on("blur.mask",$).on("keydown.mask",T).on("keypress.mask",C).on("input.mask paste.mask",function(){x.prop("readonly")||setTimeout(function(){var t=k(!0);x.caret(t),s()},0)}),o&&r&&x.off("input.mask").on("input.mask",w),k()})}})});